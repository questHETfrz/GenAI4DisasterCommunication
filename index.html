<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>灾害风险沟通AI助手</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body { background-color: #f4f6f8; }
.message { max-width: 80%; padding: 10px 14px; border-radius: 16px; margin: 8px 0; line-height: 1.6; }
.system { background-color: #e0f2fe; align-self: flex-start; }
.user { background-color: #d1fae5; align-self: flex-end; }
button { transition: 0.2s; }
button:disabled { opacity: 0.5; cursor: not-allowed; }
.typing::after { content: "▋"; animation: blink 1s infinite; }
@keyframes blink { 0%, 50% { opacity: 1; } 51%,100% { opacity: 0; } }
</style>
</head>
<body class="flex flex-col items-center justify-start min-h-screen p-4">

<div id="chat" class="flex flex-col w-full max-w-2xl bg-white p-4 rounded-2xl shadow-lg overflow-y-auto" style="height: 80vh;"></div>

<script>
const chat = document.getElementById("chat");

function addMessage(text, sender="system") {
  const msg = document.createElement("div");
  msg.className = `message ${sender}`;
  msg.textContent = text;
  chat.appendChild(msg);
  chat.scrollTop = chat.scrollHeight;
  return msg;
}

function typeMessage(text, sender="system", delay=30) {
  return new Promise(resolve => {
    const msg = document.createElement("div");
    msg.className = `message ${sender}`;
    chat.appendChild(msg);
    chat.scrollTop = chat.scrollHeight;
    let i = 0;
    const timer = setInterval(() => {
      msg.textContent = text.slice(0, i++);
      if (i > text.length) {
        clearInterval(timer);
        resolve();
      }
      chat.scrollTop = chat.scrollHeight;
    }, delay);
  });
}

async function startChat() {
  await typeMessage("您好！我是灾害风险沟通AI助手。针对此次台风“风神”，您有什么特别关心的问题吗？请从以下问题中选择您想了解的内容：");
  await showQuestions(group1);
}

const group1 = {
  title: "（一）信息获取与风险认知",
  questions: [
    {
      q: "台风要来之前，我应该重点看哪些官方消息？",
      a: "您需要锁定权威信息源，例如本地气象台和应急管理部门发布的消息。关键要获取台风预计的登陆地点、时间、风力等级以及降雨预报。特别要注意政府发布的撤离通知、指定疏散路线和避难场所位置。这是做出正确决策的第一步。此外，您还需学会判断自身所处环境是否高危（如临水、低洼地区），并掌握在户外突遇险情的紧急避险原则：立即寻找坚固场所躲避，远离易倒坠物和积水。"
    },
    {
      q: "我家住在什么位置算比较危险？什么情况就该撤离了？",
      a: "如果您家位于海边、河边、低洼地带、山脚、边坡附近，这些地方易受风暴潮、洪水、泥石流威胁，风险较高。一旦接到街道、社区的正式撤离通知，或者观察到水位快速上涨、山体有异响等危险征兆，就必须果断撤离。切勿心存侥幸，生命安全第一位。做出撤离决策的前提是持续关注官方预警信息以获取指令。若在外出时遭遇风暴，请牢记紧急避险的核心要领：寻找坚固建筑躲避，远离一切危险源。"
    },
    {
      q: "在外面突然遇到狂风暴雨，怎么紧急避险？",
      a: "立即寻找坚固的建筑物（如大型商场、图书馆）进去躲避。远离所有可能倒塌或坠落的东西，比如广告牌、脚手架、玻璃幕墙。特别要避开积水区域，水下情况不明，可能暗藏打开的窖井或漏电风险。不要在水边、桥上停留。预防远胜于遇险。请务必提前通过官方渠道跟踪台风动态，并审慎评估自家位置的风险等级，必要时果断提前撤离，避免外出陷入险境。"
    }
  ]
};

const group2 = {
  title: "（二）具体防护措施与应急准备",
  questions: [
    {
      q: "家里该提前备好哪些应急物资？",
      a: "建议准备一个“应急包”，包括食物、水、照明和充电设备、急救包和常用药品、一些现金（停电时无法电子支付）、重要证件复印件。物资储备量最好能满足全家至少3天的基本需求。记得将应急包放在容易拿取的位置。准备好物资后，还需对住宅进行彻底的内外安全检查（如加固高处物品、疏通管道），并了解台风来临即使在家也需注意的安全细节（如远离窗户、及时断电）。"
    },
    {
      q: "怎么检查房子才最安全，防止东西掉下去或家里进水？",
      a: "安全检查分“对外”和“对内”。对外包括仔细检查阳台、窗台，将花盆、杂物等全部收回室内，检查空调外机、雨棚等是否牢固。对内包括重点检查窗户密封性，低洼处的插座最好用防水盖保护，并将家具、电器垫高或移至楼上。提前疏通排水管至关重要。完成房屋检查的同时，请确认已备齐至少维持3天的应急物资并放在易取处。台风来袭时，在室内的核心安全守则是远离门窗并预防触电。"
    },
    {
      q: "台风天已经待在家里了，还有什么要特别注意的安全细节？",
      a: "即使在家也需保持警惕。首要的是远离门窗，避免玻璃破裂伤人。可以用胶带在玻璃上贴成“米”字形增加韧性。同时，要关闭不必要的电器，拔掉电源插头，以防电压不稳或进水引发事故。如果屋内开始进水，立即切断总电源。家的安全建立在事前的充分准备之上：包括备好应急包和完成房屋的内外安全检查（如收回高空物品、疏通排水管）。"
    }
  ]
};

const group3 = {
  title: "（三）外出行为与安全准则",
  questions: [
    {
      q: "万一有急事必须出门，怎么走比较安全？",
      a: "强烈建议取消不必要出行。如情况紧急，优先选择公共交通工具，避免自驾。若必须步行，请穿防滑的鞋子、紧身雨衣，颜色要鲜艳以便被救援人员发现。绝对不要打伞，伞面易被风兜住，非常危险。避开广告牌、大树和电线杆。若必须驾车，请遵循“慢稳停”原则，警惕积水和侧风。台风过后回家，首要任务是谨慎检查房屋结构和用电用气安全，防范次生灾害。"
    },
    {
      q: "台风天开车，有什么特别的驾驶技巧？",
      a: "核心是“慢”和“稳”。减速慢行，紧握方向盘，因为侧风可能让车发飘。暴雨时能见度极低，应开启雾灯和双闪，就近找安全地带停车等待，但切记不要停在树下或广告牌下。路面积水深度超过轮胎一半时，不可强行通过。相比之下，步行外出风险更高，应穿戴醒目雨具、避开危险区域。无论何种出行，灾后返家都需执行严格的安全检查程序，确认无误后再恢复正常生活。"
    },
    {
      q: "台风过后回家，进门首先要检查什么？",
      a: "返回后先别急着正常用电用水。第一步，检查房屋结构是否安全，有无裂缝或倾斜。第二步，用干木棒等绝缘体检查电源和煤气，闻闻有无燃气味。在确认电路、燃气绝对安全前，严禁开火和使用电器，防止次生灾害。本次台风期间，最安全的选择是避免一切不必要的外出。若必须步行或驾车，请务必遵循各自特定的安全准则，以最大限度规避风险。"
    }
  ]
};

async function showQuestions(group) {
  await typeMessage(group.title);
  const container = document.createElement("div");
  container.className = "flex flex-col gap-2 ml-4";
  group.questions.forEach(({q, a}) => {
    const btn = document.createElement("button");
    btn.textContent = q;
    btn.className = "text-left px-4 py-2 bg-blue-100 rounded-xl hover:bg-blue-200";
    btn.onclick = async () => {
      Array.from(container.querySelectorAll("button")).forEach(b => b.disabled = true);
      addMessage(q, "user");
      await typeMessage(a, "system");
      if (group === group1) await showQuestions(group2);
      else if (group === group2) await showQuestions(group3);
      else endChat();
    };
    container.appendChild(btn);
  });
  chat.appendChild(container);
  chat.scrollTop = chat.scrollHeight;
}

function endChat() {
  const exitBtn = document.createElement("button");
  exitBtn.textContent = "退出对话";
  exitBtn.className = "mt-4 px-4 py-2 bg-red-200 rounded-xl hover:bg-red-300";
  exitBtn.onclick = () => window.close();
  chat.appendChild(exitBtn);
  chat.scrollTop = chat.scrollHeight;
}

startChat();
</script>
</body>
</html>
